<!DOCTYPE html>
<html>
<head>
    <title>Mall Map Prototype</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap"/>
    <link rel="stylesheet" href="css/mallMap.css"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <script src="https://kit.fontawesome.com/c073ebcd4d.js" crossorigin="anonymous"></script>
    <script src="https://unpkg.com/textures@1.2.0/dist/textures.js"></script>
    <script src="https://d3js.org/d3.v6.min.js" type="text/javascript"></script>
</head>
<body>
<div id="header_div">
    <input type="radio" class="datasetChoice" name="datasetChoice" id="0" value="0" checked><label for="0">Dataset 1</label>
    <input type="radio" class="datasetChoice" name="datasetChoice" id="1" value="1"><label for="1">Dataset 2</label>
</div>
<div id="breadcrumb_div"></div>
<div id="chart_div"></div>
<div id="footer_div"></div>
<div class="d3_tooltip"></div>


<script type="text/javascript" src="js/mallMap.js"></script>
<script type="text/javascript" src="js/mallMapReusables.js"></script>
<script type="text/javascript" src="js/mallMapProperties.js"></script>
<script>

    var promises = [
        d3.json("data/dataset_1.json"),
        d3.json("data/dataset_2.json"),

    ]

    Promise.all(promises).then(ready)

    function ready(all_datasets) {

        var datasetChoice = "0";

        //add an id to each node (temp hopefully)
        all_datasets.forEach(function(d,i){
            var myID = 0;
            d.id = "dataset_" + i + "_" + myID;
            myID += 1;
            d.children = addId(d.children,i);

            function addId(myChildren,myIndex){
                myChildren.forEach(function(c){
                    c.id = "dataset_" + myIndex + "_" + myID;
                    myID += 1
                    if(c.children !== undefined){
                        addId(c.children,myIndex);
                    }
                })
                return myChildren;
            }

        })

        initialiseDashboard(all_datasets[datasetChoice],"chart_div","breadcrumb_div","footer_div");

        d3.selectAll(".datasetChoice")
            .on("change",function(d){
                datasetChoice = this.value;
                initialiseDashboard(all_datasets[datasetChoice],"chart_div","breadcrumb_div","footer_div");
            });
    };


    //functions used to stripData from Observable demos down to only what's needed and same format
    //chart now loads with this stripped data.

    function stripData1 (myDataset){
        var newData = {};
        var fieldNames = ["name","value"];

        addDetails(myDataset, newData);

        function addDetails(myDescendant, currentData) {
            fieldNames.forEach(function (f) {
                currentData[f] = myDescendant[f];
            });
            currentData["colors"] = {
                "functional":myDescendant["functional_color"],
                "dev":myDescendant["dev_color"],
                "default":myDescendant["color"]
            }
            if (myDescendant.children !== undefined) {
                currentData.children = [];
            }
            var children = myDescendant.children;
            if (myDescendant.children === null) {
                children = myDescendant._children;
            }
            if (children !== undefined) {
                children.forEach(function (c, i) {
                    currentData.children.push({});
                    addDetails(c, currentData.children[i]);
                });
            }
        }

        return newData;
    }

    function stripData2 (myDataset){
        var newData = {};
        var fieldNames = ["name","value"];

        addDetails(myDataset, newData);

        function addDetails(myDescendant, currentData) {
            fieldNames.forEach(function (f) {
                currentData[f] = myDescendant[f];
            });
            currentData["colors"] = {
                "default":myDescendant["colorname"]
            }
            if (myDescendant.children !== undefined) {
                currentData.children = [];
            }
            var children = myDescendant.children;
            if (myDescendant.children === null) {
                children = myDescendant._children;
            }
            if (children !== undefined) {
                children.forEach(function (c, i) {
                    currentData.children.push({});
                    addDetails(c, currentData.children[i]);
                });
            }
        }

        return newData;
    }
</script>
</body>
</html>
